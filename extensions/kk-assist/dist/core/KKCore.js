"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const KKUtils_1 = __importDefault(require("./KKUtils"));
const os_1 = require("os");
class KKCore {
    static async doInitProjAsy(pfx) {
        let fwPath = (0, path_1.join)(Editor.Project.path, "assets", "framework");
        if ((0, fs_extra_1.existsSync)(fwPath)) {
            Editor.Dialog.warn("The project has been initialized!", {
                buttons: ["OK"]
            });
        }
        else {
            console.log("Start initializing ...");
            let dstPath = (0, path_1.join)(Editor.Project.path, "assets");
            let srcPath = (0, path_1.join)(KKUtils_1.default.getPluginPath(), "template", "init");
            let files = (0, fs_extra_1.readdirSync)(srcPath);
            files.forEach((fn) => {
                (0, fs_extra_1.copySync)((0, path_1.join)(srcPath, fn), (0, path_1.join)(dstPath, fn));
            });
            let confPath = (0, path_1.join)(dstPath, "Boot", "Scripts", "GameUIConf.ts");
            if ((0, fs_extra_1.existsSync)(confPath)) {
                (0, fs_extra_1.renameSync)(confPath, confPath.replace("GameUIConf", pfx + "GameUIConf"));
            }
            else {
                console.error("Cannot find the GameUIConf.ts");
                return;
            }
            KKCore.projPrefix = pfx;
            //只是对资源的刷新，如果添加了新代码，代码有个编译时间不包含在内
            //programming:compiled 编译完毕的广播事件
            await KKUtils_1.default.refreshResAsy("db://assets");
            //等待代码编译完毕
            await KKUtils_1.default.checkFramework();
            await KKUtils_1.default.genSceneAsy("db://assets/Boot/Stage.scene");
            await KKUtils_1.default.openSceneAsy("db://assets/Boot/Stage.scene");
            let rootInfo = await KKUtils_1.default.getSceneRootNodeInfoAsy();
            //@ts-ignore
            let nodeUuid = rootInfo.children[0].uuid;
            let uuid1 = await KKUtils_1.default.url2uuidAsy("db://assets/framework/widget/Adapter.ts");
            await KKUtils_1.default.genCompAsy(nodeUuid, Editor.Utils.UUID.compressUUID(uuid1, false));
            let uuid2 = await KKUtils_1.default.url2uuidAsy("db://assets/Boot/Scripts/Stage.ts");
            await KKUtils_1.default.genCompAsy(nodeUuid, Editor.Utils.UUID.compressUUID(uuid2, false));
            await KKUtils_1.default.saveSceneAsy();
            console.log("Initialization complete.");
        }
    }
    /////////////////////////////////////////////////////////////////////////////////////////////
    static getBundles() {
        let bundles = [];
        let assetPath = (0, path_1.join)(Editor.Project.path, "assets");
        (0, fs_extra_1.readdirSync)(assetPath).map(itemName => {
            var _a;
            let abPath = (0, path_1.join)(assetPath, itemName);
            if ((0, fs_extra_1.statSync)(abPath).isDirectory() && itemName != "resources") {
                let meta = (0, fs_extra_1.readJsonSync)(abPath + ".meta");
                if ((_a = meta.userData) === null || _a === void 0 ? void 0 : _a.isBundle) {
                    bundles.push(itemName);
                }
            }
        });
        return bundles;
    }
    static async doCreateBundle(bundleName, priority) {
        let bundlePathUrl = "db://assets/" + bundleName;
        let bundlePath = await KKUtils_1.default.url2pathAsy(bundlePathUrl);
        if ((0, fs_extra_1.existsSync)(bundlePath)) {
            Editor.Dialog.warn(bundleName + " already exists", {
                buttons: ["OK"]
            });
            return false;
        }
        else {
            (0, fs_extra_1.mkdirSync)(bundlePath);
            await KKUtils_1.default.refreshResAsy(bundlePathUrl);
            let metaPath = bundlePath + '.meta';
            if ((0, fs_extra_1.existsSync)(metaPath)) {
                let meta = (0, fs_extra_1.readJsonSync)(metaPath);
                meta.userData.isBundle = true;
                meta.userData.priority = priority;
                (0, fs_extra_1.outputJsonSync)(metaPath, meta);
                await KKUtils_1.default.refreshResAsy(bundlePathUrl);
                (0, fs_extra_1.mkdirSync)((0, path_1.join)(bundlePath, "Prefabs"));
                (0, fs_extra_1.mkdirSync)((0, path_1.join)(bundlePath, "Scripts"));
                (0, fs_extra_1.mkdirSync)((0, path_1.join)(bundlePath, "Textures"));
                await KKUtils_1.default.refreshResAsy(bundlePathUrl);
                let confUrl = KKUtils_1.default.getConfUrl(KKCore.projPrefix);
                let confPath = await KKUtils_1.default.url2pathAsy(confUrl);
                let confStr = (0, fs_extra_1.readFileSync)(confPath, 'utf-8');
                if (confStr.indexOf("@bundle") == -1) {
                    confStr += `\nexport const ${KKCore.projPrefix}BundleConf = {\n\t//@bundle\n};`;
                }
                confStr = confStr.replace("//@bundle", `${KKUtils_1.default.removePfxAndSfx(bundleName, KKCore.projPrefix, "Bundle")}: "${bundleName}",\n\t//@bundle`);
                (0, fs_extra_1.writeFileSync)(confPath, confStr);
                await KKUtils_1.default.refreshResAsy(confUrl);
                console.log(bundleName + " created!");
                return true;
            }
            else {
                console.error('Can not find meta file!');
                return false;
            }
        }
    }
    static async doCreateLayer(layerName, bundleName, cacheMode) {
        let isOK = await KKCore.genUIUnit("Layer", layerName, bundleName);
        if (isOK) {
            let bdl = KKUtils_1.default.removePfxAndSfx(bundleName, KKCore.projPrefix, "Bundle");
            let tag = "@layer";
            let caches = cacheMode != 0 ? (cacheMode == 1 ? "\n\t\tcacheMode: UICacheMode.Cache" : "\n\t\tcacheMode: UICacheMode.Stay") : "";
            await KKCore.genUIConf("Layer", layerName, bdl, tag, caches);
        }
    }
    static async doCreatePopup(popupName, bundleName, cacheMode) {
        let isOK = await KKCore.genUIUnit("Popup", popupName, bundleName);
        if (isOK) {
            let bdl = KKUtils_1.default.removePfxAndSfx(bundleName, KKCore.projPrefix, "Bundle");
            let tag = `@${bdl.toLowerCase()}_popup`;
            let caches = cacheMode == 0 ? "" : "\n\t\tcacheMode: UICacheMode.Cache";
            await KKCore.genUIConf("Popup", popupName, bdl, tag, caches);
        }
    }
    static async doCreatePanel(panelName, bundleName, cacheMode) {
        let isOK = await KKCore.genUIUnit("Panel", panelName, bundleName);
        if (isOK) {
            let bdl = KKUtils_1.default.removePfxAndSfx(bundleName, KKCore.projPrefix, "Bundle");
            let tag = `@${bdl.toLowerCase()}_Panel`;
            let caches = cacheMode == 0 ? "" : "\n\t\tcacheMode: UICacheMode.Cache";
            await KKCore.genUIConf("Panel", panelName, bdl, tag, caches);
        }
    }
    static async doCreateWidget(widgetName, bundleName, cacheMode) {
        let isOK = await KKCore.genUIUnit("Widget", widgetName, bundleName);
        if (isOK) {
            let bdl = KKUtils_1.default.removePfxAndSfx(bundleName, KKCore.projPrefix, "Bundle");
            let tag = `@${bdl.toLowerCase()}_Widget`;
            let caches = cacheMode == 0 ? "" : "\n\t\tcacheMode: UICacheMode.Cache";
            await KKCore.genUIConf("Widget", widgetName, bdl, tag, caches);
        }
    }
    static async genUIConf(typeName, uiName, bdl, tag, cacheContent) {
        let confUrl = KKUtils_1.default.getConfUrl(KKCore.projPrefix);
        let confPath = await KKUtils_1.default.url2pathAsy(confUrl);
        let confStr = (0, fs_extra_1.readFileSync)(confPath, 'utf-8');
        if (confStr.indexOf(tag) == -1) {
            confStr += `\nexport const ${KKCore.projPrefix + (typeName == "Layer" ? "" : bdl)}${typeName}Conf = {\n\t//${tag}\n};\n`;
        }
        confStr = confStr.replace("//" + tag, `${KKUtils_1.default.removePfxAndSfx(uiName, KKCore.projPrefix, typeName)}: <IUIConfig> {
        bundle: ${KKCore.projPrefix}BundleConf.${bdl},
        name: "${uiName}",${cacheContent}
    },

    //${tag}`);
        (0, fs_extra_1.writeFileSync)(confPath, confStr);
        await KKUtils_1.default.refreshResAsy(confUrl);
    }
    static async genUIUnit(typeName, uiName, bundleName) {
        let bundleUrl = "db://assets/" + bundleName;
        let typeDirUrl = `${bundleUrl}/Prefabs/${typeName}`;
        let typeDirPath = await KKUtils_1.default.url2pathAsy(typeDirUrl);
        if (!(0, fs_extra_1.existsSync)(typeDirPath)) {
            (0, fs_extra_1.mkdirSync)(typeDirPath);
            await KKUtils_1.default.refreshResAsy(typeDirUrl);
        }
        let prefabUrl = `${typeDirUrl}/${uiName}.prefab`;
        let prefabPath = await KKUtils_1.default.url2pathAsy(prefabUrl);
        if ((0, fs_extra_1.existsSync)(prefabPath)) {
            Editor.Dialog.warn(uiName + " already exists", {
                buttons: ["OK"]
            });
            return false;
        }
        else {
            let tsUrl = bundleUrl + "/Scripts/" + uiName + ".ts";
            let tsPath = await KKUtils_1.default.url2pathAsy(tsUrl);
            (0, fs_extra_1.copyFileSync)((0, path_1.join)(KKUtils_1.default.getPluginPath(), "template", `Template${typeName}.ts`), tsPath);
            (0, fs_extra_1.copyFileSync)((0, path_1.join)(KKUtils_1.default.getPluginPath(), "template", "TemplatePfb.prefab"), prefabPath);
            let tsStr = (0, fs_extra_1.readFileSync)(tsPath).toString();
            tsStr = tsStr.replace("@author", "@author " + (0, os_1.hostname)());
            tsStr = tsStr.replace("@created", "@created " + (new Date()).toLocaleString());
            (0, fs_extra_1.writeFileSync)(tsPath, tsStr.replace(new RegExp("NewClass", 'g'), uiName));
            await KKUtils_1.default.refreshResAsy(tsUrl);
            let tsUUID = await KKUtils_1.default.url2uuidAsy(tsUrl);
            let compressUuid = Editor.Utils.UUID.compressUUID(tsUUID, false);
            let prefabStr = (0, fs_extra_1.readJsonSync)(prefabPath);
            prefabStr[0]._name = uiName;
            prefabStr[1]._name = uiName;
            prefabStr[6].__type__ = compressUuid;
            prefabStr.forEach((one, i) => {
                if (one.fileId) {
                    one.fileId = Editor.Utils.UUID.generate(true);
                }
            });
            (0, fs_extra_1.outputJsonSync)(prefabPath, prefabStr);
            await KKUtils_1.default.refreshResAsy(prefabUrl);
            console.log(`${uiName} created!`);
            return true;
        }
    }
    /////////////////////////////////////////////////////////////////////////////////////////////
    static getCodeCount() {
        let codeInfo = {
            code: 0, //有效行数
            space: 0, //空行数
            comment: 0, //注释行数
            total: 0, //总行数
        };
        let checkDir = (dirPath) => {
            let files = (0, fs_extra_1.readdirSync)(dirPath);
            files.forEach((fileName) => {
                let subPath = (0, path_1.join)(dirPath, fileName);
                let stat = (0, fs_extra_1.statSync)(subPath);
                if (stat.isDirectory()) {
                    checkDir(subPath);
                }
                else if (stat.isFile() && (0, path_1.extname)(fileName) == ".ts") {
                    let content = (0, fs_extra_1.readFileSync)(subPath, 'utf-8');
                    let lines = content.split('\n');
                    let inMultilineComment = false;
                    lines.forEach((line) => {
                        let trimLine = line.trim();
                        if (trimLine === "") {
                            codeInfo.space += 1;
                        }
                        else if (trimLine.startsWith("//")) {
                            codeInfo.comment += 1;
                        }
                        else if (trimLine.startsWith("/*")) {
                            codeInfo.comment += 1;
                            inMultilineComment = true;
                        }
                        else if (trimLine.endsWith("*/")) {
                            codeInfo.comment += 1;
                            inMultilineComment = false;
                        }
                        else if (inMultilineComment) {
                            codeInfo.comment += 1;
                        }
                        else {
                            codeInfo.code += 1;
                        }
                    });
                }
            });
        };
        checkDir((0, path_1.join)(Editor.Project.path, "assets"));
        codeInfo.total = codeInfo.code + codeInfo.space + codeInfo.comment;
        return codeInfo;
    }
    static getResCount() {
        let extInfo = {};
        let checkDir = (dirPath) => {
            let files = (0, fs_extra_1.readdirSync)(dirPath);
            files.forEach((fileName) => {
                let subPath = (0, path_1.join)(dirPath, fileName);
                let stat = (0, fs_extra_1.statSync)(subPath);
                if (stat.isDirectory()) {
                    checkDir(subPath);
                }
                else if (stat.isFile()) {
                    let ext = (0, path_1.extname)(fileName);
                    if (!ext)
                        ext = "unknown";
                    if (extInfo[ext]) {
                        extInfo[ext].num += 1;
                        extInfo[ext].size += stat.size;
                    }
                    else {
                        extInfo[ext] = {
                            num: 1,
                            size: stat.size
                        };
                    }
                }
            });
        };
        checkDir((0, path_1.join)(Editor.Project.path, "assets"));
        return extInfo;
    }
}
KKCore.projPrefix = "";
exports.default = KKCore;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiS0tDb3JlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc291cmNlL2NvcmUvS0tDb3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsdUNBQXVLO0FBQ3ZLLCtCQUFxQztBQUNyQyx3REFBZ0M7QUFDaEMsMkJBQThCO0FBRTlCLE1BQXFCLE1BQU07SUFJdkIsTUFBTSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsR0FBVztRQUNsQyxJQUFJLE1BQU0sR0FBRyxJQUFBLFdBQUksRUFBQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7UUFDOUQsSUFBSSxJQUFBLHFCQUFVLEVBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUNyQixNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxtQ0FBbUMsRUFBRTtnQkFDcEQsT0FBTyxFQUFFLENBQUMsSUFBSSxDQUFDO2FBQ2xCLENBQUMsQ0FBQztRQUNQLENBQUM7YUFBTSxDQUFDO1lBQ0osT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO1lBQ3RDLElBQUksT0FBTyxHQUFHLElBQUEsV0FBSSxFQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBRWxELElBQUksT0FBTyxHQUFHLElBQUEsV0FBSSxFQUFDLGlCQUFPLENBQUMsYUFBYSxFQUFFLEVBQUUsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ2hFLElBQUksS0FBSyxHQUFHLElBQUEsc0JBQVcsRUFBQyxPQUFPLENBQUMsQ0FBQztZQUNqQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUU7Z0JBQ2pCLElBQUEsbUJBQVEsRUFBQyxJQUFBLFdBQUksRUFBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLEVBQUUsSUFBQSxXQUFJLEVBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFD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TyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7d0JBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQztvQkFDbkMsQ0FBQzt5QkFBTSxDQUFDO3dCQUNKLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRzs0QkFDWCxHQUFHLEVBQUUsQ0FBQzs0QkFDTixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7eUJBQ2xCLENBQUM7b0JBQ04sQ0FBQztnQkFDTCxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUM7UUFDUCxDQUFDLENBQUM7UUFFRixRQUFRLENBQUMsSUFBQSxXQUFJLEVBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUU5QyxPQUFPLE9BQU8sQ0FBQztJQUNuQixDQUFDOztBQTNTTSxpQkFBVSxHQUFXLEVBQUUsQ0FBQztrQkFGZCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCB7IGNvcHlGaWxlU3luYywgY29weVN5bmMsIGV4aXN0c1N5bmMsIG1rZGlyU3luYywgb3V0cHV0SnNvblN5bmMsIHJlYWRGaWxlU3luYywgcmVhZEpzb25TeW5jLCByZWFkZGlyU3luYywgcmVuYW1lU3luYywgc3RhdFN5bmMsIHdyaXRlRmlsZVN5bmMgfSBmcm9tIFwiZnMtZXh0cmFcIjtcclxuaW1wb3J0IHsgZXh0bmFtZSwgam9pbiB9IGZyb20gXCJwYXRoXCI7XHJcbmltcG9ydCBLS1V0aWxzIGZyb20gXCIuL0tLVXRpbHNcIjtcclxuaW1wb3J0IHsgaG9zdG5hbWUgfSBmcm9tIFwib3NcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEtLQ29yZSB7XHJcblxyXG4gICAgc3RhdGljIHByb2pQcmVmaXg6IHN0cmluZyA9IFwiXCI7XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGRvSW5pdFByb2pBc3kocGZ4OiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgZndQYXRoID0gam9pbihFZGl0b3IuUHJvamVjdC5wYXRoLCBcImFzc2V0c1wiLCBcImZyYW1ld29ya1wiKTtcclxuICAgICAgICBpZiAoZXhpc3RzU3luYyhmd1BhdGgpKSB7XHJcbiAgICAgICAgICAgIEVkaXRvci5EaWFsb2cud2FybihcIlRoZSBwcm9qZWN0IGhhcyBiZWVuIGluaXRpYWxpemVkIVwiLCB7XHJcbiAgICAgICAgICAgICAgICBidXR0b25zOiBbXCJPS1wiXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIlN0YXJ0IGluaXRpYWxpemluZyAuLi5cIik7XHJcbiAgICAgICAgICAgIGxldCBkc3RQYXRoID0gam9pbihFZGl0b3IuUHJvamVjdC5wYXRoLCBcImFzc2V0c1wiKTtcclxuXHJcbiAgICAgICAgICAgIGxldCBzcmNQYXRoID0gam9pbihLS1V0aWxzLmdldFBsdWdpblBhdGgoKSwgXCJ0ZW1wbGF0ZVwiLCBcImluaXRcIik7XHJcbiAgICAgICAgICAgIGxldCBmaWxlcyA9IHJlYWRkaXJTeW5jKHNyY1BhdGgpO1xyXG4gICAgICAgICAgICBmaWxlcy5mb3JFYWNoKChmbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29weVN5bmMoam9pbihzcmNQYXRoLCBmbiksIGpvaW4oZHN0UGF0aCwgZm4pKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBsZXQgY29uZlBhdGggPSBqb2luKGRzdFBhdGgsIFwiQm9vdFwiLCBcIlNjcmlwdHNcIiwgXCJHYW1lVUlDb25mLnRzXCIpO1xyXG4gICAgICAgICAgICBpZiAoZXhpc3RzU3luYyhjb25mUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIHJlbmFtZVN5bmMoY29uZlBhdGgsIGNvbmZQYXRoLnJlcGxhY2UoXCJHYW1lVUlDb25mXCIsIHBmeCArIFwiR2FtZVVJQ29uZlwiKSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQ2Fubm90IGZpbmQgdGhlIEdhbWVVSUNvbmYudHNcIik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgS0tDb3JlLnByb2pQcmVmaXggPSBwZng7XHJcblxyXG4gICAgICAgICAgICAvL+WPquaYr+Wvuei1hOa6kOeahOWIt+aWsO+8jOWmguaenOa3u+WKoOS6huaWsOS7o+egge+8jOS7o+eggeacieS4que8luivkeaXtumXtOS4jeWMheWQq+WcqOWGhVxyXG4gICAgICAgICAgICAvL3Byb2dyYW1taW5nOmNvbXBpbGVkIOe8luivkeWujOavleeahOW5v+aSreS6i+S7tlxyXG4gICAgICAgICAgICBhd2FpdCBLS1V0aWxzLnJlZnJlc2hSZXNBc3koXCJkYjovL2Fzc2V0c1wiKTtcclxuICAgICAgICAgICAgLy/nrYnlvoXku6PnoIHnvJbor5Hlrozmr5VcclxuICAgICAgICAgICAgYXdhaXQgS0tVdGlscy5jaGVja0ZyYW1ld29yaygpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgS0tVdGlscy5nZW5TY2VuZUFzeShcImRiOi8vYXNzZXRzL0Jvb3QvU3RhZ2Uuc2NlbmVcIik7XHJcbiAgICAgICAgICAgIGF3YWl0IEtLVXRpbHMub3BlblNjZW5lQXN5KFwiZGI6Ly9hc3NldHMvQm9vdC9TdGFnZS5zY2VuZVwiKTtcclxuICAgICAgICAgICAgbGV0IHJvb3RJbmZvID0gYXdhaXQgS0tVdGlscy5nZXRTY2VuZVJvb3ROb2RlSW5mb0FzeSgpO1xyXG4gICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgbGV0IG5vZGVVdWlkOiBzdHJpbmcgPSByb290SW5mby5jaGlsZHJlblswXS51dWlkO1xyXG4gICAgICAgICAgICBsZXQgdXVpZDEgPSBhd2FpdCBLS1V0aWxzLnVybDJ1dWlkQXN5KFwiZGI6Ly9hc3NldHMvZnJhbWV3b3JrL3dpZGdldC9BZGFwdGVyLnRzXCIpO1xyXG4gICAgICAgICAgICBhd2FpdCBLS1V0aWxzLmdlbkNvbXBBc3kobm9kZVV1aWQsIEVkaXRvci5VdGlscy5VVUlELmNvbXByZXNzVVVJRCh1dWlkMSwgZmFsc2UpKTtcclxuICAgICAgICAgICAgbGV0IHV1aWQyID0gYXdhaXQgS0tVdGlscy51cmwydXVpZEFzeShcImRiOi8vYXNzZXRzL0Jvb3QvU2NyaXB0cy9TdGFnZS50c1wiKTtcclxuICAgICAgICAgICAgYXdhaXQgS0tVdGlscy5nZW5Db21wQXN5KG5vZGVVdWlkLCBFZGl0b3IuVXRpbHMuVVVJRC5jb21wcmVzc1VVSUQodXVpZDIsIGZhbHNlKSk7XHJcbiAgICAgICAgICAgIGF3YWl0IEtLVXRpbHMuc2F2ZVNjZW5lQXN5KCk7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkluaXRpYWxpemF0aW9uIGNvbXBsZXRlLlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgc3RhdGljIGdldEJ1bmRsZXMoKSB7XHJcbiAgICAgICAgbGV0IGJ1bmRsZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICAgICAgbGV0IGFzc2V0UGF0aCA9IGpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgXCJhc3NldHNcIik7XHJcbiAgICAgICAgcmVhZGRpclN5bmMoYXNzZXRQYXRoKS5tYXAoaXRlbU5hbWUgPT4ge1xyXG4gICAgICAgICAgICBsZXQgYWJQYXRoID0gam9pbihhc3NldFBhdGgsIGl0ZW1OYW1lKTtcclxuICAgICAgICAgICAgaWYgKHN0YXRTeW5jKGFiUGF0aCkuaXNEaXJlY3RvcnkoKSAmJiBpdGVtTmFtZSAhPSBcInJlc291cmNlc1wiKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbWV0YSA9IHJlYWRKc29uU3luYyhhYlBhdGggKyBcIi5tZXRhXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1ldGEudXNlckRhdGE/LmlzQnVuZGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnVuZGxlcy5wdXNoKGl0ZW1OYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBidW5kbGVzO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhc3luYyBkb0NyZWF0ZUJ1bmRsZShidW5kbGVOYW1lOiBzdHJpbmcsIHByaW9yaXR5OiBudW1iZXIpIHtcclxuICAgICAgICBsZXQgYnVuZGxlUGF0aFVybCA9IFwiZGI6Ly9hc3NldHMvXCIgKyBidW5kbGVOYW1lO1xyXG4gICAgICAgIGxldCBidW5kbGVQYXRoID0gYXdhaXQgS0tVdGlscy51cmwycGF0aEFzeShidW5kbGVQYXRoVXJsKTtcclxuXHJcbiAgICAgICAgaWYgKGV4aXN0c1N5bmMoYnVuZGxlUGF0aCkpIHtcclxuICAgICAgICAgICAgRWRpdG9yLkRpYWxvZy53YXJuKGJ1bmRsZU5hbWUgKyBcIiBhbHJlYWR5IGV4aXN0c1wiLCB7XHJcbiAgICAgICAgICAgICAgICBidXR0b25zOiBbXCJPS1wiXVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIG1rZGlyU3luYyhidW5kbGVQYXRoKTtcclxuICAgICAgICAgICAgYXdhaXQgS0tVdGlscy5yZWZyZXNoUmVzQXN5KGJ1bmRsZVBhdGhVcmwpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGxldCBtZXRhUGF0aCA9IGJ1bmRsZVBhdGggKyAnLm1ldGEnO1xyXG4gICAgICAgICAgICBpZiAoZXhpc3RzU3luYyhtZXRhUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgIGxldCBtZXRhID0gcmVhZEpzb25TeW5jKG1ldGFQYXRoKTtcclxuICAgICAgICAgICAgICAgIG1ldGEudXNlckRhdGEuaXNCdW5kbGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgbWV0YS51c2VyRGF0YS5wcmlvcml0eSA9IHByaW9yaXR5O1xyXG4gICAgICAgICAgICAgICAgb3V0cHV0SnNvblN5bmMobWV0YVBhdGgsIG1ldGEpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgS0tVdGlscy5yZWZyZXNoUmVzQXN5KGJ1bmRsZVBhdGhVcmwpO1xyXG5cclxuICAgICAgICAgICAgICAgIG1rZGlyU3luYyhqb2luKGJ1bmRsZVBhdGgsIFwiUHJlZmFic1wiKSk7XHJcbiAgICAgICAgICAgICAgICBta2RpclN5bmMoam9pbihidW5kbGVQYXRoLCBcIlNjcmlwdHNcIikpO1xyXG4gICAgICAgICAgICAgICAgbWtkaXJTeW5jKGpvaW4oYnVuZGxlUGF0aCwgXCJUZXh0dXJlc1wiKSk7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBLS1V0aWxzLnJlZnJlc2hSZXNBc3koYnVuZGxlUGF0aFVybCk7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IGNvbmZVcmwgPSBLS1V0aWxzLmdldENvbmZVcmwoS0tDb3JlLnByb2pQcmVmaXgpO1xyXG4gICAgICAgICAgICAgICAgbGV0IGNvbmZQYXRoID0gYXdhaXQgS0tVdGlscy51cmwycGF0aEFzeShjb25mVXJsKTtcclxuICAgICAgICAgICAgICAgIGxldCBjb25mU3RyID0gcmVhZEZpbGVTeW5jKGNvbmZQYXRoLCAndXRmLTgnKTtcclxuICAgICAgICAgICAgICAgIGlmIChjb25mU3RyLmluZGV4T2YoXCJAYnVuZGxlXCIpID09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uZlN0ciArPSBgXFxuZXhwb3J0IGNvbnN0ICR7S0tDb3JlLnByb2pQcmVmaXh9QnVuZGxlQ29uZiA9IHtcXG5cXHQvL0BidW5kbGVcXG59O2A7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25mU3RyID0gY29uZlN0ci5yZXBsYWNlKFwiLy9AYnVuZGxlXCIsIGAke0tLVXRpbHMucmVtb3ZlUGZ4QW5kU2Z4KGJ1bmRsZU5hbWUsIEtLQ29yZS5wcm9qUHJlZml4LCBcIkJ1bmRsZVwiKX06IFwiJHtidW5kbGVOYW1lfVwiLFxcblxcdC8vQGJ1bmRsZWApO1xyXG4gICAgICAgICAgICAgICAgd3JpdGVGaWxlU3luYyhjb25mUGF0aCwgY29uZlN0cik7XHJcbiAgICAgICAgICAgICAgICBhd2FpdCBLS1V0aWxzLnJlZnJlc2hSZXNBc3koY29uZlVybCk7XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYnVuZGxlTmFtZSArIFwiIGNyZWF0ZWQhXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDYW4gbm90IGZpbmQgbWV0YSBmaWxlIScpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhc3luYyBkb0NyZWF0ZUxheWVyKGxheWVyTmFtZTogc3RyaW5nLCBidW5kbGVOYW1lOiBzdHJpbmcsIGNhY2hlTW9kZTogbnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IGlzT0sgPSBhd2FpdCBLS0NvcmUuZ2VuVUlVbml0KFwiTGF5ZXJcIiwgbGF5ZXJOYW1lLCBidW5kbGVOYW1lKTtcclxuICAgICAgICBpZiAoaXNPSykge1xyXG4gICAgICAgICAgICBsZXQgYmRsID0gS0tVdGlscy5yZW1vdmVQZnhBbmRTZngoYnVuZGxlTmFtZSwgS0tDb3JlLnByb2pQcmVmaXgsIFwiQnVuZGxlXCIpO1xyXG4gICAgICAgICAgICBsZXQgdGFnID0gXCJAbGF5ZXJcIjtcclxuICAgICAgICAgICAgbGV0IGNhY2hlcyA9IGNhY2hlTW9kZSAhPSAwID8gKGNhY2hlTW9kZSA9PSAxID8gXCJcXG5cXHRcXHRjYWNoZU1vZGU6IFVJQ2FjaGVNb2RlLkNhY2hlXCIgOiBcIlxcblxcdFxcdGNhY2hlTW9kZTogVUlDYWNoZU1vZGUuU3RheVwiKSA6IFwiXCI7XHJcbiAgICAgICAgICAgIGF3YWl0IEtLQ29yZS5nZW5VSUNvbmYoXCJMYXllclwiLCBsYXllck5hbWUsIGJkbCwgdGFnLCBjYWNoZXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgZG9DcmVhdGVQb3B1cChwb3B1cE5hbWU6IHN0cmluZywgYnVuZGxlTmFtZTogc3RyaW5nLCBjYWNoZU1vZGU6IG51bWJlcikge1xyXG4gICAgICAgIGxldCBpc09LID0gYXdhaXQgS0tDb3JlLmdlblVJVW5pdChcIlBvcHVwXCIsIHBvcHVwTmFtZSwgYnVuZGxlTmFtZSk7XHJcbiAgICAgICAgaWYgKGlzT0spIHtcclxuICAgICAgICAgICAgbGV0IGJkbCA9IEtLVXRpbHMucmVtb3ZlUGZ4QW5kU2Z4KGJ1bmRsZU5hbWUsIEtLQ29yZS5wcm9qUHJlZml4LCBcIkJ1bmRsZVwiKTtcclxuICAgICAgICAgICAgbGV0IHRhZyA9IGBAJHtiZGwudG9Mb3dlckNhc2UoKX1fcG9wdXBgO1xyXG4gICAgICAgICAgICBsZXQgY2FjaGVzID0gY2FjaGVNb2RlID09IDAgPyBcIlwiIDogXCJcXG5cXHRcXHRjYWNoZU1vZGU6IFVJQ2FjaGVNb2RlLkNhY2hlXCI7XHJcbiAgICAgICAgICAgIGF3YWl0IEtLQ29yZS5nZW5VSUNvbmYoXCJQb3B1cFwiLCBwb3B1cE5hbWUsIGJkbCwgdGFnLCBjYWNoZXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgZG9DcmVhdGVQYW5lbChwYW5lbE5hbWU6IHN0cmluZywgYnVuZGxlTmFtZTogc3RyaW5nLCBjYWNoZU1vZGU6IG51bWJlcikge1xyXG4gICAgICAgIGxldCBpc09LID0gYXdhaXQgS0tDb3JlLmdlblVJVW5pdChcIlBhbmVsXCIsIHBhbmVsTmFtZSwgYnVuZGxlTmFtZSk7XHJcbiAgICAgICAgaWYgKGlzT0spIHtcclxuICAgICAgICAgICAgbGV0IGJkbCA9IEtLVXRpbHMucmVtb3ZlUGZ4QW5kU2Z4KGJ1bmRsZU5hbWUsIEtLQ29yZS5wcm9qUHJlZml4LCBcIkJ1bmRsZVwiKTtcclxuICAgICAgICAgICAgbGV0IHRhZyA9IGBAJHtiZGwudG9Mb3dlckNhc2UoKX1fUGFuZWxgO1xyXG4gICAgICAgICAgICBsZXQgY2FjaGVzID0gY2FjaGVNb2RlID09IDAgPyBcIlwiIDogXCJcXG5cXHRcXHRjYWNoZU1vZGU6IFVJQ2FjaGVNb2RlLkNhY2hlXCI7XHJcbiAgICAgICAgICAgIGF3YWl0IEtLQ29yZS5nZW5VSUNvbmYoXCJQYW5lbFwiLCBwYW5lbE5hbWUsIGJkbCwgdGFnLCBjYWNoZXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgYXN5bmMgZG9DcmVhdGVXaWRnZXQod2lkZ2V0TmFtZTogc3RyaW5nLCBidW5kbGVOYW1lOiBzdHJpbmcsIGNhY2hlTW9kZTogbnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IGlzT0sgPSBhd2FpdCBLS0NvcmUuZ2VuVUlVbml0KFwiV2lkZ2V0XCIsIHdpZGdldE5hbWUsIGJ1bmRsZU5hbWUpO1xyXG4gICAgICAgIGlmIChpc09LKSB7XHJcbiAgICAgICAgICAgIGxldCBiZGwgPSBLS1V0aWxzLnJlbW92ZVBmeEFuZFNmeChidW5kbGVOYW1lLCBLS0NvcmUucHJvalByZWZpeCwgXCJCdW5kbGVcIik7XHJcbiAgICAgICAgICAgIGxldCB0YWcgPSBgQCR7YmRsLnRvTG93ZXJDYXNlKCl9X1dpZGdldGA7XHJcbiAgICAgICAgICAgIGxldCBjYWNoZXMgPSBjYWNoZU1vZGUgPT0gMCA/IFwiXCIgOiBcIlxcblxcdFxcdGNhY2hlTW9kZTogVUlDYWNoZU1vZGUuQ2FjaGVcIjtcclxuICAgICAgICAgICAgYXdhaXQgS0tDb3JlLmdlblVJQ29uZihcIldpZGdldFwiLCB3aWRnZXROYW1lLCBiZGwsIHRhZywgY2FjaGVzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGdlblVJQ29uZih0eXBlTmFtZTogc3RyaW5nLCB1aU5hbWU6IHN0cmluZywgYmRsOiBzdHJpbmcsIHRhZzogc3RyaW5nLCBjYWNoZUNvbnRlbnQ6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBjb25mVXJsID0gS0tVdGlscy5nZXRDb25mVXJsKEtLQ29yZS5wcm9qUHJlZml4KTtcclxuICAgICAgICBsZXQgY29uZlBhdGggPSBhd2FpdCBLS1V0aWxzLnVybDJwYXRoQXN5KGNvbmZVcmwpO1xyXG4gICAgICAgIGxldCBjb25mU3RyID0gcmVhZEZpbGVTeW5jKGNvbmZQYXRoLCAndXRmLTgnKTtcclxuICAgICAgICBpZiAoY29uZlN0ci5pbmRleE9mKHRhZykgPT0gLTEpIHtcclxuICAgICAgICAgICAgY29uZlN0ciArPSBgXFxuZXhwb3J0IGNvbnN0ICR7S0tDb3JlLnByb2pQcmVmaXggKyAodHlwZU5hbWUgPT0gXCJMYXllclwiID8gXCJcIiA6IGJkbCl9JHt0eXBlTmFtZX1Db25mID0ge1xcblxcdC8vJHt0YWd9XFxufTtcXG5gO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uZlN0ciA9IGNvbmZTdHIucmVwbGFjZShcIi8vXCIgKyB0YWcsIGAke0tLVXRpbHMucmVtb3ZlUGZ4QW5kU2Z4KHVpTmFtZSwgS0tDb3JlLnByb2pQcmVmaXgsIHR5cGVOYW1lKX06IDxJVUlDb25maWc+IHtcclxuICAgICAgICBidW5kbGU6ICR7S0tDb3JlLnByb2pQcmVmaXh9QnVuZGxlQ29uZi4ke2JkbH0sXHJcbiAgICAgICAgbmFtZTogXCIke3VpTmFtZX1cIiwke2NhY2hlQ29udGVudH1cclxuICAgIH0sXHJcblxyXG4gICAgLy8ke3RhZ31gKTtcclxuXHJcbiAgICAgICAgd3JpdGVGaWxlU3luYyhjb25mUGF0aCwgY29uZlN0cik7XHJcbiAgICAgICAgYXdhaXQgS0tVdGlscy5yZWZyZXNoUmVzQXN5KGNvbmZVcmwpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhc3luYyBnZW5VSVVuaXQodHlwZU5hbWU6IHN0cmluZywgdWlOYW1lOiBzdHJpbmcsIGJ1bmRsZU5hbWU6IHN0cmluZykge1xyXG4gICAgICAgIGxldCBidW5kbGVVcmwgPSBcImRiOi8vYXNzZXRzL1wiICsgYnVuZGxlTmFtZTtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgdHlwZURpclVybCA9IGAke2J1bmRsZVVybH0vUHJlZmFicy8ke3R5cGVOYW1lfWA7XHJcbiAgICAgICAgbGV0IHR5cGVEaXJQYXRoID0gYXdhaXQgS0tVdGlscy51cmwycGF0aEFzeSh0eXBlRGlyVXJsKTtcclxuICAgICAgICBpZiAoIWV4aXN0c1N5bmModHlwZURpclBhdGgpKSB7XHJcbiAgICAgICAgICAgIG1rZGlyU3luYyh0eXBlRGlyUGF0aCk7XHJcbiAgICAgICAgICAgIGF3YWl0IEtLVXRpbHMucmVmcmVzaFJlc0FzeSh0eXBlRGlyVXJsKTtcclxuICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICBsZXQgcHJlZmFiVXJsID0gYCR7dHlwZURpclVybH0vJHt1aU5hbWV9LnByZWZhYmA7XHJcbiAgICAgICAgbGV0IHByZWZhYlBhdGggPSBhd2FpdCBLS1V0aWxzLnVybDJwYXRoQXN5KHByZWZhYlVybCk7XHJcbiAgICAgICAgaWYgKGV4aXN0c1N5bmMocHJlZmFiUGF0aCkpIHtcclxuICAgICAgICAgICAgRWRpdG9yLkRpYWxvZy53YXJuKHVpTmFtZSArIFwiIGFscmVhZHkgZXhpc3RzXCIsIHtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbnM6IFtcIk9LXCJdXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IHRzVXJsID0gYnVuZGxlVXJsICsgXCIvU2NyaXB0cy9cIiArIHVpTmFtZSArIFwiLnRzXCI7XHJcbiAgICAgICAgICAgIGxldCB0c1BhdGggPSBhd2FpdCBLS1V0aWxzLnVybDJwYXRoQXN5KHRzVXJsKTtcclxuICAgICAgICAgICAgY29weUZpbGVTeW5jKGpvaW4oS0tVdGlscy5nZXRQbHVnaW5QYXRoKCksIFwidGVtcGxhdGVcIiwgYFRlbXBsYXRlJHt0eXBlTmFtZX0udHNgKSwgdHNQYXRoKTtcclxuICAgICAgICAgICAgY29weUZpbGVTeW5jKGpvaW4oS0tVdGlscy5nZXRQbHVnaW5QYXRoKCksIFwidGVtcGxhdGVcIiwgXCJUZW1wbGF0ZVBmYi5wcmVmYWJcIiksIHByZWZhYlBhdGgpO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGxldCB0c1N0ciA9IHJlYWRGaWxlU3luYyh0c1BhdGgpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIHRzU3RyID0gdHNTdHIucmVwbGFjZShcIkBhdXRob3JcIiwgXCJAYXV0aG9yIFwiICsgaG9zdG5hbWUoKSk7XHJcbiAgICAgICAgICAgIHRzU3RyID0gdHNTdHIucmVwbGFjZShcIkBjcmVhdGVkXCIsIFwiQGNyZWF0ZWQgXCIgKyAobmV3IERhdGUoKSkudG9Mb2NhbGVTdHJpbmcoKSk7XHJcbiAgICAgICAgICAgIHdyaXRlRmlsZVN5bmModHNQYXRoLCB0c1N0ci5yZXBsYWNlKG5ldyBSZWdFeHAoXCJOZXdDbGFzc1wiLCAnZycpLCB1aU5hbWUpKTtcclxuICAgIFxyXG4gICAgICAgICAgICBhd2FpdCBLS1V0aWxzLnJlZnJlc2hSZXNBc3kodHNVcmwpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHRzVVVJRCA9IGF3YWl0IEtLVXRpbHMudXJsMnV1aWRBc3kodHNVcmwpO1xyXG4gICAgICAgICAgICBsZXQgY29tcHJlc3NVdWlkID0gRWRpdG9yLlV0aWxzLlVVSUQuY29tcHJlc3NVVUlEKHRzVVVJRCwgZmFsc2UpO1xyXG5cclxuICAgICAgICAgICAgbGV0IHByZWZhYlN0ciA9IHJlYWRKc29uU3luYyhwcmVmYWJQYXRoKTtcclxuICAgICAgICAgICAgcHJlZmFiU3RyWzBdLl9uYW1lID0gdWlOYW1lO1xyXG4gICAgICAgICAgICBwcmVmYWJTdHJbMV0uX25hbWUgPSB1aU5hbWU7XHJcbiAgICAgICAgICAgIHByZWZhYlN0cls2XS5fX3R5cGVfXyA9IGNvbXByZXNzVXVpZDtcclxuICAgICAgICAgICAgcHJlZmFiU3RyLmZvckVhY2goKG9uZTogYW55LCBpOiBudW1iZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChvbmUuZmlsZUlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb25lLmZpbGVJZCA9IEVkaXRvci5VdGlscy5VVUlELmdlbmVyYXRlKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgb3V0cHV0SnNvblN5bmMocHJlZmFiUGF0aCwgcHJlZmFiU3RyKTtcclxuICAgICAgICAgICAgYXdhaXQgS0tVdGlscy5yZWZyZXNoUmVzQXN5KHByZWZhYlVybCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3VpTmFtZX0gY3JlYXRlZCFgKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG5cclxuICAgIHN0YXRpYyBnZXRDb2RlQ291bnQoKSB7XHJcbiAgICAgICAgbGV0IGNvZGVJbmZvID0ge1xyXG4gICAgICAgICAgICBjb2RlOiAwLCAgICAgICAgLy/mnInmlYjooYzmlbBcclxuICAgICAgICAgICAgc3BhY2U6IDAsICAgICAgIC8v56m66KGM5pWwXHJcbiAgICAgICAgICAgIGNvbW1lbnQ6IDAsICAgICAvL+azqOmHiuihjOaVsFxyXG4gICAgICAgICAgICB0b3RhbDogMCwgICAgICAgLy/mgLvooYzmlbBcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBsZXQgY2hlY2tEaXIgPSAoZGlyUGF0aDogc3RyaW5nKSA9PiB7XHJcbiAgICAgICAgICAgIGxldCBmaWxlcyA9IHJlYWRkaXJTeW5jKGRpclBhdGgpO1xyXG4gICAgICAgICAgICBmaWxlcy5mb3JFYWNoKChmaWxlTmFtZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IHN1YlBhdGggPSBqb2luKGRpclBhdGgsIGZpbGVOYW1lKTtcclxuICAgICAgICAgICAgICAgIGxldCBzdGF0ID0gc3RhdFN5bmMoc3ViUGF0aCk7XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoZWNrRGlyKHN1YlBhdGgpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0LmlzRmlsZSgpICYmIGV4dG5hbWUoZmlsZU5hbWUpID09IFwiLnRzXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgY29udGVudCA9IHJlYWRGaWxlU3luYyhzdWJQYXRoLCAndXRmLTgnKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgaW5NdWx0aWxpbmVDb21tZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgbGluZXMuZm9yRWFjaCgobGluZSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdHJpbUxpbmUgPSBsaW5lLnRyaW0oKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0cmltTGluZSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZUluZm8uc3BhY2UgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0cmltTGluZS5zdGFydHNXaXRoKFwiLy9cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVJbmZvLmNvbW1lbnQgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0cmltTGluZS5zdGFydHNXaXRoKFwiLypcIikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvZGVJbmZvLmNvbW1lbnQgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluTXVsdGlsaW5lQ29tbWVudCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHJpbUxpbmUuZW5kc1dpdGgoXCIqL1wiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZUluZm8uY29tbWVudCArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5NdWx0aWxpbmVDb21tZW50ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaW5NdWx0aWxpbmVDb21tZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlSW5mby5jb21tZW50ICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlSW5mby5jb2RlICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY2hlY2tEaXIoam9pbihFZGl0b3IuUHJvamVjdC5wYXRoLCBcImFzc2V0c1wiKSk7XHJcbiAgICAgICAgY29kZUluZm8udG90YWwgPSBjb2RlSW5mby5jb2RlICsgY29kZUluZm8uc3BhY2UgKyBjb2RlSW5mby5jb21tZW50O1xyXG5cclxuICAgICAgICByZXR1cm4gY29kZUluZm87XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldFJlc0NvdW50KCkge1xyXG4gICAgICAgIGxldCBleHRJbmZvOiB7W2tleTogc3RyaW5nXTogeyBudW06IG51bWJlciwgc2l6ZTogbnVtYmVyIH19ID0ge307XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IGNoZWNrRGlyID0gKGRpclBhdGg6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICBsZXQgZmlsZXMgPSByZWFkZGlyU3luYyhkaXJQYXRoKTtcclxuICAgICAgICAgICAgZmlsZXMuZm9yRWFjaCgoZmlsZU5hbWUpID0+IHtcclxuICAgICAgICAgICAgICAgIGxldCBzdWJQYXRoID0gam9pbihkaXJQYXRoLCBmaWxlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3RhdCA9IHN0YXRTeW5jKHN1YlBhdGgpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChzdGF0LmlzRGlyZWN0b3J5KCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGVja0RpcihzdWJQYXRoKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdC5pc0ZpbGUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBleHQgPSBleHRuYW1lKGZpbGVOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIWV4dCkgZXh0ID0gXCJ1bmtub3duXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV4dEluZm9bZXh0XSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRJbmZvW2V4dF0ubnVtICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dEluZm9bZXh0XS5zaXplICs9IHN0YXQuc2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHRJbmZvW2V4dF0gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW06IDEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBzdGF0LnNpemVcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGNoZWNrRGlyKGpvaW4oRWRpdG9yLlByb2plY3QucGF0aCwgXCJhc3NldHNcIikpO1xyXG5cclxuICAgICAgICByZXR1cm4gZXh0SW5mbztcclxuICAgIH1cclxuXHJcbn0iXX0=