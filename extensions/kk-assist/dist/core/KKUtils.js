"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
const package_json_1 = __importDefault(require("../../package.json"));
const fs_extra_1 = require("fs-extra");
class KKUtils {
    static sleepAsy(t) {
        return new Promise((resolve, reject) => {
            setTimeout(() => {
                resolve();
            }, t * 1000);
        });
    }
    static biggerThanVer(ver) {
        let tgtVers = ver.split('.');
        let curVers = Editor.App.version.split('.');
        for (let i = 0; i < curVers.length; ++i) {
            if (Number(curVers[i]) > Number(tgtVers[i])) {
                return true;
            }
        }
        return false;
    }
    static getPluginPath() {
        return (0, path_1.join)(Editor.Project.path, "extensions", package_json_1.default.name);
    }
    static getConfUrl(pfx) {
        return `db://assets/Boot/Scripts/${pfx}GameUIConf.ts`;
    }
    static removePfxAndSfx(s, pfx, sfx) {
        return s.substring(pfx.length, s.length - sfx.length);
    }
    static url2pathAsy(url) {
        return new Promise((resolve, reject) => {
            Editor.Message.request('asset-db', 'query-path', url)
                .then((str) => {
                resolve(str ? str : "");
            })
                .catch(reject);
        });
    }
    static uuid2pathAsy(uuid) {
        return KKUtils.url2pathAsy(uuid);
    }
    static url2uuidAsy(url) {
        return new Promise((resolve, reject) => {
            Editor.Message.request('asset-db', 'query-uuid', url)
                .then((str) => {
                resolve(str ? str : "");
            })
                .catch(reject);
        });
    }
    /**
     * 如果有嵌套资源，子资源要在后面更新，否则编辑器不显示，需要手动刷新
     */
    static refreshResAsy(urlOrUuid) {
        return Editor.Message.request('asset-db', 'refresh-asset', urlOrUuid);
    }
    static genSceneAsy(url) {
        let astUrl = '';
        if (KKUtils.biggerThanVer("3.8.2"))
            astUrl = 'db://internal/default_file_content/scene/scene-2d.scene';
        else
            astUrl = 'db://internal/default_file_content/scene-2d';
        return KKUtils.genAssetsAsy(url, astUrl);
    }
    static async genAssetsAsy(targetUrl, templateUrl) {
        let url = await Editor.Message.request('asset-db', 'generate-available-url', targetUrl);
        let templatePath = await KKUtils.url2pathAsy(templateUrl);
        let infoContent = (0, fs_extra_1.readFileSync)(templatePath).toString();
        await Editor.Message.request('asset-db', 'create-asset', url, infoContent, {});
        console.log(`gen ${targetUrl} successfully`);
    }
    static async openSceneAsy(url) {
        let uuid = await KKUtils.url2uuidAsy(url);
        await Editor.Message.request('scene', 'open-scene', uuid);
    }
    static saveSceneAsy() {
        return Editor.Message.request('scene', 'save-scene');
    }
    static genCompAsy(nodeUuid, compUuid) {
        return Editor.Message.request('scene', 'create-component', {
            uuid: nodeUuid,
            component: compUuid
        });
    }
    static getSceneRootNodeInfoAsy() {
        return Editor.Message.request('scene', 'query-node-tree');
    }
    static getNodeInfoAsy(nodeUuid) {
        return Editor.Message.request('scene', 'query-node', nodeUuid);
    }
    static getCompInfoAsy(compUuid) {
        return Editor.Message.request('scene', 'query-component', compUuid);
    }
    static setPropertyAsy(scriptNodeUuid, scriptOrder, propName, propType, propUUid) {
        return Editor.Message.request('scene', 'set-property', {
            uuid: scriptNodeUuid,
            path: `__comps__.${scriptOrder}.${propName}`,
            dump: {
                type: propType,
                value: {
                    uuid: propUUid,
                },
            },
        });
    }
    static checkFramework() {
        let _check = (rsv) => {
            Editor.Message.request('scene', 'query-classes', {
                extends: "cc.Component"
            }).then((infos) => {
                let isOK = false;
                for (let l = infos.length - 1; l >= 0; --l) {
                    if (infos[l].name == 'Adapter') {
                        isOK = true;
                        break;
                    }
                }
                if (isOK) {
                    rsv();
                }
                else {
                    setTimeout(() => { _check(rsv); }, 300);
                }
            });
        };
        return new Promise((resolve, reject) => {
            _check(resolve);
        });
    }
}
exports.default = KKUtils;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiS0tVdGlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9jb3JlL0tLVXRpbHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFDQSwrQkFBNEI7QUFDNUIsc0VBQTZDO0FBQzdDLHVDQUF3QztBQUV4QyxNQUFxQixPQUFPO0lBQ3hCLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBUztRQUNyQixPQUFPLElBQUksT0FBTyxDQUFPLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO1lBQ3pDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7Z0JBQ1osT0FBTyxFQUFFLENBQUM7WUFDZCxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztJQUVELE1BQU0sQ0FBQyxhQUFhLENBQUMsR0FBVztRQUM1QixJQUFJLE9BQU8sR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUU1QyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQ3RDLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO2dCQUMxQyxPQUFPLElBQUksQ0FBQztZQUNoQixDQUFDO1FBQ0wsQ0FBQztRQUVELE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxNQUFNLENBQUMsYUFBYTtRQUNoQixPQUFPLElBQUEsV0FBSSxFQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRSxzQkFBVyxDQUFDLElBQUks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QyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDcEIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0NBQ0o7QUFuSkQsMEJBbUpDIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdwYXRoJztcclxuaW1wb3J0IHBhY2thZ2VKU09OIGZyb20gJy4uLy4uL3BhY2thZ2UuanNvbic7XHJcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gJ2ZzLWV4dHJhJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEtLVXRpbHMge1xyXG4gICAgc3RhdGljIHNsZWVwQXN5KHQ6IG51bWJlcikge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICB9LCB0ICogMTAwMCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGJpZ2dlclRoYW5WZXIodmVyOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgdGd0VmVycyA9IHZlci5zcGxpdCgnLicpO1xyXG4gICAgICAgIGxldCBjdXJWZXJzID0gRWRpdG9yLkFwcC52ZXJzaW9uLnNwbGl0KCcuJyk7XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VyVmVycy5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICBpZiAoTnVtYmVyKGN1clZlcnNbaV0pID4gTnVtYmVyKHRndFZlcnNbaV0pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXRQbHVnaW5QYXRoKCkge1xyXG4gICAgICAgIHJldHVybiBqb2luKEVkaXRvci5Qcm9qZWN0LnBhdGgsIFwiZXh0ZW5zaW9uc1wiLCBwYWNrYWdlSlNPTi5uYW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0Q29uZlVybChwZng6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBgZGI6Ly9hc3NldHMvQm9vdC9TY3JpcHRzLyR7cGZ4fUdhbWVVSUNvbmYudHNgO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyByZW1vdmVQZnhBbmRTZngoczogc3RyaW5nLCBwZng6IHN0cmluZywgc2Z4OiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gcy5zdWJzdHJpbmcocGZ4Lmxlbmd0aCwgcy5sZW5ndGggLSBzZngubGVuZ3RoKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgdXJsMnBhdGhBc3kodXJsOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2U8c3RyaW5nPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ2Fzc2V0LWRiJywgJ3F1ZXJ5LXBhdGgnLCB1cmwpXHJcbiAgICAgICAgICAgIC50aGVuKChzdHIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlc29sdmUoc3RyID8gc3RyIDogXCJcIik7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5jYXRjaChyZWplY3QpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyB1dWlkMnBhdGhBc3kodXVpZDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIEtLVXRpbHMudXJsMnBhdGhBc3kodXVpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHVybDJ1dWlkQXN5KHVybDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPHN0cmluZz4oKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgICAgICBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdhc3NldC1kYicsICdxdWVyeS11dWlkJywgdXJsKVxyXG4gICAgICAgICAgICAudGhlbigoc3RyKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZXNvbHZlKHN0ciA/IHN0ciA6IFwiXCIpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuY2F0Y2gocmVqZWN0KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWmguaenOacieW1jOWll+i1hOa6kO+8jOWtkOi1hOa6kOimgeWcqOWQjumdouabtOaWsO+8jOWQpuWImee8lui+keWZqOS4jeaYvuekuu+8jOmcgOimgeaJi+WKqOWIt+aWsFxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgcmVmcmVzaFJlc0FzeSh1cmxPclV1aWQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdhc3NldC1kYicsICdyZWZyZXNoLWFzc2V0JywgdXJsT3JVdWlkKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2VuU2NlbmVBc3kodXJsOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgYXN0VXJsID0gJyc7XHJcbiAgICAgICAgaWYgKEtLVXRpbHMuYmlnZ2VyVGhhblZlcihcIjMuOC4yXCIpKSBhc3RVcmwgPSAnZGI6Ly9pbnRlcm5hbC9kZWZhdWx0X2ZpbGVfY29udGVudC9zY2VuZS9zY2VuZS0yZC5zY2VuZSc7XHJcbiAgICAgICAgZWxzZSBhc3RVcmwgPSAnZGI6Ly9pbnRlcm5hbC9kZWZhdWx0X2ZpbGVfY29udGVudC9zY2VuZS0yZCc7XHJcblxyXG4gICAgICAgIHJldHVybiBLS1V0aWxzLmdlbkFzc2V0c0FzeSh1cmwsIGFzdFVybCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGFzeW5jIGdlbkFzc2V0c0FzeSh0YXJnZXRVcmw6IHN0cmluZywgdGVtcGxhdGVVcmw6IHN0cmluZykge1xyXG4gICAgICAgIGxldCB1cmwgPSBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdhc3NldC1kYicsICdnZW5lcmF0ZS1hdmFpbGFibGUtdXJsJywgdGFyZ2V0VXJsKTtcclxuICAgICAgICBsZXQgdGVtcGxhdGVQYXRoID0gYXdhaXQgS0tVdGlscy51cmwycGF0aEFzeSh0ZW1wbGF0ZVVybCk7XHJcbiAgICAgICAgbGV0IGluZm9Db250ZW50ID0gcmVhZEZpbGVTeW5jKHRlbXBsYXRlUGF0aCkudG9TdHJpbmcoKTtcclxuXHJcbiAgICAgICAgYXdhaXQgRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnYXNzZXQtZGInLCAnY3JlYXRlLWFzc2V0JywgdXJsLCBpbmZvQ29udGVudCwge30pO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBnZW4gJHt0YXJnZXRVcmx9IHN1Y2Nlc3NmdWxseWApO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBhc3luYyBvcGVuU2NlbmVBc3kodXJsOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgdXVpZCA9IGF3YWl0IEtLVXRpbHMudXJsMnV1aWRBc3kodXJsKTtcclxuICAgICAgICBhd2FpdCBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdvcGVuLXNjZW5lJywgdXVpZCk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHNhdmVTY2VuZUFzeSgpIHtcclxuICAgICAgICByZXR1cm4gRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnc2NlbmUnLCAnc2F2ZS1zY2VuZScpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZW5Db21wQXN5KG5vZGVVdWlkOiBzdHJpbmcsIGNvbXBVdWlkOiBzdHJpbmcpIHtcclxuICAgICAgICByZXR1cm4gRWRpdG9yLk1lc3NhZ2UucmVxdWVzdCgnc2NlbmUnLCAnY3JlYXRlLWNvbXBvbmVudCcsIHsgXHJcbiAgICAgICAgICAgIHV1aWQ6IG5vZGVVdWlkLFxyXG4gICAgICAgICAgICBjb21wb25lbnQ6IGNvbXBVdWlkXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGdldFNjZW5lUm9vdE5vZGVJbmZvQXN5KCkge1xyXG4gICAgICAgIHJldHVybiBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdxdWVyeS1ub2RlLXRyZWUnKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZ2V0Tm9kZUluZm9Bc3kobm9kZVV1aWQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdxdWVyeS1ub2RlJywgbm9kZVV1aWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBnZXRDb21wSW5mb0FzeShjb21wVXVpZDogc3RyaW5nKSB7XHJcbiAgICAgICAgcmV0dXJuIEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ3NjZW5lJywgJ3F1ZXJ5LWNvbXBvbmVudCcsIGNvbXBVdWlkKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgc2V0UHJvcGVydHlBc3koc2NyaXB0Tm9kZVV1aWQ6IHN0cmluZywgc2NyaXB0T3JkZXI6IG51bWJlciwgcHJvcE5hbWU6IHN0cmluZywgcHJvcFR5cGU6IHN0cmluZywgcHJvcFVVaWQ6IHN0cmluZykge1xyXG4gICAgICAgIHJldHVybiBFZGl0b3IuTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdzZXQtcHJvcGVydHknLCB7XHJcbiAgICAgICAgICAgIHV1aWQ6IHNjcmlwdE5vZGVVdWlkLFxyXG4gICAgICAgICAgICBwYXRoOiBgX19jb21wc19fLiR7c2NyaXB0T3JkZXJ9LiR7cHJvcE5hbWV9YCxcclxuICAgICAgICAgICAgZHVtcDoge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogcHJvcFR5cGUsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHV1aWQ6IHByb3BVVWlkLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgY2hlY2tGcmFtZXdvcmsoKSB7XHJcbiAgICAgICAgbGV0IF9jaGVjayA9IChyc3Y6IEZ1bmN0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgIEVkaXRvci5NZXNzYWdlLnJlcXVlc3QoJ3NjZW5lJywgJ3F1ZXJ5LWNsYXNzZXMnLCB7XHJcbiAgICAgICAgICAgICAgICBleHRlbmRzOiBcImNjLkNvbXBvbmVudFwiXHJcbiAgICAgICAgICAgIH0pLnRoZW4oKGluZm9zKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaXNPSyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgbCA9IGluZm9zLmxlbmd0aCAtIDE7IGwgPj0gMDsgLS1sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZm9zW2xdLm5hbWUgPT0gJ0FkYXB0ZXInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlzT0sgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaXNPSykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJzdigpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsgX2NoZWNrKHJzdik7IH0sIDMwMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZTx2b2lkPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgICAgIF9jaGVjayhyZXNvbHZlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSJdfQ==