"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.onNodeMenu = void 0;
const fs_extra_1 = require("fs-extra");
const KKUtils_1 = __importDefault(require("./core/KKUtils"));
function getPropCode(typeName, propName) {
    return `
    @property(${typeName})
    private ${propName}: ${typeName} = null;`;
}
async function onNodeMenu(info) {
    if (!info)
        return [];
    let nodeInfo = await KKUtils_1.default.getNodeInfoAsy(info.uuid);
    if (!nodeInfo.__prefab__)
        return [];
    let rootNodeUUid = nodeInfo.__prefab__.rootUuid;
    let rootInfo = await KKUtils_1.default.getNodeInfoAsy(rootNodeUUid);
    let scriptName = rootInfo.name.value;
    let scriptOrder = -1;
    let scriptUuid;
    for (let i = 0; i < rootInfo.__comps__.length; ++i) {
        if (rootInfo.__comps__[i].type == scriptName) {
            scriptOrder = i;
            scriptUuid = rootInfo.__comps__[i].cid;
            break;
        }
    }
    if (!scriptUuid) {
        console.log("Cant find root script");
        return [];
    }
    const deUuid = Editor.Utils.UUID.decompressUUID(scriptUuid);
    const scriptPath = await KKUtils_1.default.uuid2pathAsy(deUuid);
    let propName = info.name;
    let compMenus = [];
    let comps = info.components;
    comps.forEach((one, i) => {
        compMenus.push({
            label: one.type,
            async click() {
                let propType = one.type;
                let propTypeName = propType;
                let importType = "";
                if (propType.startsWith("cc.")) {
                    propTypeName = propType.substring(3);
                    importType = propTypeName;
                }
                else if (propType.startsWith("sp.") || propType.startsWith("dragonBones.")) {
                    importType = propType.split('.')[0];
                }
                else {
                    console.warn(`Unsupport ${propType}`);
                    return;
                }
                let propCode = getPropCode(propTypeName, propName);
                let tsStr = (0, fs_extra_1.readFileSync)(scriptPath, "utf-8");
                let matchRst = tsStr.match(/ extends .*?{/);
                if (!matchRst) {
                    console.log("reg match failed");
                    return;
                }
                tsStr = tsStr.replace(matchRst[0], matchRst[0] + '\n' + propCode);
                matchRst = tsStr.match(/import .*?}/);
                if (matchRst) {
                    if (!matchRst[0].includes(importType)) {
                        tsStr = tsStr.replace(" } from 'cc'", `, ${importType} } from 'cc'`);
                    }
                }
                (0, fs_extra_1.writeFileSync)(scriptPath, tsStr, "utf-8");
                await KKUtils_1.default.refreshResAsy(deUuid);
                await KKUtils_1.default.sleepAsy(0.5);
                await KKUtils_1.default.setPropertyAsy(rootNodeUUid, scriptOrder, propName, propType, one.value);
            }
        });
    });
    return [
        {
            label: "快速绑定",
            submenu: [
                {
                    label: "节点",
                    async click() {
                        let propCode = getPropCode("Node", propName);
                        let tsStr = (0, fs_extra_1.readFileSync)(scriptPath, "utf-8");
                        let matchRst = tsStr.match(/ extends .*?{/);
                        if (!matchRst) {
                            console.log("reg match failed");
                            return;
                        }
                        tsStr = tsStr.replace(matchRst[0], matchRst[0] + '\n' + propCode);
                        (0, fs_extra_1.writeFileSync)(scriptPath, tsStr, "utf-8");
                        await KKUtils_1.default.refreshResAsy(deUuid);
                        await KKUtils_1.default.sleepAsy(0.5);
                        await KKUtils_1.default.setPropertyAsy(rootNodeUUid, scriptOrder, propName, "cc.Node", info.uuid);
                    }
                },
                {
                    label: "组件",
                    submenu: compMenus
                }
            ]
        }
    ];
}
exports.onNodeMenu = onNodeMenu;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGllcmFyY2h5LW1lbnUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zb3VyY2UvaGllcmFyY2h5LW1lbnUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsdUNBQXVEO0FBQ3ZELDZEQUFxQztBQUVyQyxTQUFTLFdBQVcsQ0FBQyxRQUFnQixFQUFFLFFBQWdCO0lBQ25ELE9BQU87Z0JBQ0ssUUFBUTtjQUNWLFFBQVEsS0FBSyxRQUFRLFVBQVUsQ0FBQztBQUM5QyxDQUFDO0FBRU0sS0FBSyxVQUFVLFVBQVUsQ0FBQyxJQUFTO0lBQ3RDLElBQUksQ0FBQyxJQUFJO1FBQUUsT0FBTyxFQUFFLENBQUM7SUFFckIsSUFBSSxRQUFRLEdBQUcsTUFBTSxpQkFBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDdkQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVO1FBQUUsT0FBTyxFQUFFLENBQUM7SUFDcEMsSUFBSSxZQUFZLEdBQUcsUUFBUSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7SUFDaEQsSUFBSSxRQUFRLEdBQUcsTUFBTSxpQkFBTyxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUMxRCxJQUFJLFVBQVUsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztJQUNyQyxJQUFJLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNyQixJQUFJLFVBQVUsQ0FBQztJQUNmLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDO1FBQ2pELElBQUksUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksVUFBVSxFQUFFLENBQUM7WUFDM0MsV0FBVyxHQUFHLENBQUMsQ0FBQztZQUNoQixVQUFVLEdBQUcsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFD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QUM1RixDQUFDO2lCQUNKO2dCQUNEO29CQUNJLEtBQUssRUFBRSxJQUFJO29CQUNYLE9BQU8sRUFBRSxTQUFTO2lCQUNyQjthQUNKO1NBQ0o7S0FDSixDQUFDO0FBQ04sQ0FBQztBQWhHRCxnQ0FnR0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyByZWFkRmlsZVN5bmMsIHdyaXRlRmlsZVN5bmMgfSBmcm9tIFwiZnMtZXh0cmFcIjtcclxuaW1wb3J0IEtLVXRpbHMgZnJvbSBcIi4vY29yZS9LS1V0aWxzXCI7XHJcblxyXG5mdW5jdGlvbiBnZXRQcm9wQ29kZSh0eXBlTmFtZTogc3RyaW5nLCBwcm9wTmFtZTogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gYFxyXG4gICAgQHByb3BlcnR5KCR7dHlwZU5hbWV9KVxyXG4gICAgcHJpdmF0ZSAke3Byb3BOYW1lfTogJHt0eXBlTmFtZX0gPSBudWxsO2A7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBvbk5vZGVNZW51KGluZm86IGFueSk6IFByb21pc2U8RWRpdG9yLk1lbnUuQmFzZU1lbnVJdGVtW10+IHtcclxuICAgIGlmICghaW5mbykgcmV0dXJuIFtdO1xyXG4gICAgXHJcbiAgICBsZXQgbm9kZUluZm8gPSBhd2FpdCBLS1V0aWxzLmdldE5vZGVJbmZvQXN5KGluZm8udXVpZCk7XHJcbiAgICBpZiAoIW5vZGVJbmZvLl9fcHJlZmFiX18pIHJldHVybiBbXTtcclxuICAgIGxldCByb290Tm9kZVVVaWQgPSBub2RlSW5mby5fX3ByZWZhYl9fLnJvb3RVdWlkO1xyXG4gICAgbGV0IHJvb3RJbmZvID0gYXdhaXQgS0tVdGlscy5nZXROb2RlSW5mb0FzeShyb290Tm9kZVVVaWQpO1xyXG4gICAgbGV0IHNjcmlwdE5hbWUgPSByb290SW5mby5uYW1lLnZhbHVlO1xyXG4gICAgbGV0IHNjcmlwdE9yZGVyID0gLTE7XHJcbiAgICBsZXQgc2NyaXB0VXVpZDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm9vdEluZm8uX19jb21wc19fLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgaWYgKHJvb3RJbmZvLl9fY29tcHNfX1tpXS50eXBlID09IHNjcmlwdE5hbWUpIHtcclxuICAgICAgICAgICAgc2NyaXB0T3JkZXIgPSBpO1xyXG4gICAgICAgICAgICBzY3JpcHRVdWlkID0gcm9vdEluZm8uX19jb21wc19fW2ldLmNpZDtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmICghc2NyaXB0VXVpZCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiQ2FudCBmaW5kIHJvb3Qgc2NyaXB0XCIpO1xyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIGNvbnN0IGRlVXVpZCA9IEVkaXRvci5VdGlscy5VVUlELmRlY29tcHJlc3NVVUlEKHNjcmlwdFV1aWQpO1xyXG4gICAgY29uc3Qgc2NyaXB0UGF0aCA9IGF3YWl0IEtLVXRpbHMudXVpZDJwYXRoQXN5KGRlVXVpZCk7XHJcblxyXG4gICAgbGV0IHByb3BOYW1lID0gaW5mby5uYW1lO1xyXG4gICAgbGV0IGNvbXBNZW51czogRWRpdG9yLk1lbnUuQmFzZU1lbnVJdGVtW10gPSBbXTtcclxuICAgIGxldCBjb21wcyA9IGluZm8uY29tcG9uZW50cztcclxuICAgIGNvbXBzLmZvckVhY2goKG9uZTogYW55LCBpOiBudW1iZXIpID0+IHtcclxuICAgICAgICBjb21wTWVudXMucHVzaCh7XHJcbiAgICAgICAgICAgIGxhYmVsOiBvbmUudHlwZSxcclxuICAgICAgICAgICAgYXN5bmMgY2xpY2soKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcHJvcFR5cGUgPSBvbmUudHlwZSBhcyBzdHJpbmc7XHJcbiAgICAgICAgICAgICAgICBsZXQgcHJvcFR5cGVOYW1lID0gcHJvcFR5cGU7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW1wb3J0VHlwZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvcFR5cGUuc3RhcnRzV2l0aChcImNjLlwiKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3BUeXBlTmFtZSA9IHByb3BUeXBlLnN1YnN0cmluZygzKTtcclxuICAgICAgICAgICAgICAgICAgICBpbXBvcnRUeXBlID0gcHJvcFR5cGVOYW1lO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9wVHlwZS5zdGFydHNXaXRoKFwic3AuXCIpIHx8IHByb3BUeXBlLnN0YXJ0c1dpdGgoXCJkcmFnb25Cb25lcy5cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbXBvcnRUeXBlID0gcHJvcFR5cGUuc3BsaXQoJy4nKVswXTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBVbnN1cHBvcnQgJHtwcm9wVHlwZX1gKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBsZXQgcHJvcENvZGUgPSBnZXRQcm9wQ29kZShwcm9wVHlwZU5hbWUsIHByb3BOYW1lKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgdHNTdHIgPSByZWFkRmlsZVN5bmMoc2NyaXB0UGF0aCwgXCJ1dGYtOFwiKTtcclxuICAgICAgICAgICAgICAgIGxldCBtYXRjaFJzdCA9IHRzU3RyLm1hdGNoKC8gZXh0ZW5kcyAuKj97LylcclxuICAgICAgICAgICAgICAgIGlmICghbWF0Y2hSc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlZyBtYXRjaCBmYWlsZWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdHNTdHIgPSB0c1N0ci5yZXBsYWNlKG1hdGNoUnN0WzBdLCBtYXRjaFJzdFswXSArICdcXG4nICsgcHJvcENvZGUpO1xyXG4gICAgICAgICAgICAgICAgbWF0Y2hSc3QgPSB0c1N0ci5tYXRjaCgvaW1wb3J0IC4qP30vKTtcclxuICAgICAgICAgICAgICAgIGlmIChtYXRjaFJzdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghbWF0Y2hSc3RbMF0uaW5jbHVkZXMoaW1wb3J0VHlwZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHNTdHIgPSB0c1N0ci5yZXBsYWNlKFwiIH0gZnJvbSAnY2MnXCIsIGAsICR7aW1wb3J0VHlwZX0gfSBmcm9tICdjYydgKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgd3JpdGVGaWxlU3luYyhzY3JpcHRQYXRoLCB0c1N0ciwgXCJ1dGYtOFwiKTtcclxuICAgICAgICAgICAgICAgIGF3YWl0IEtLVXRpbHMucmVmcmVzaFJlc0FzeShkZVV1aWQpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgS0tVdGlscy5zbGVlcEFzeSgwLjUpO1xyXG4gICAgICAgICAgICAgICAgYXdhaXQgS0tVdGlscy5zZXRQcm9wZXJ0eUFzeShyb290Tm9kZVVVaWQsIHNjcmlwdE9yZGVyLCBwcm9wTmFtZSwgcHJvcFR5cGUsIG9uZS52YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGxhYmVsOiBcIuW/q+mAn+e7keWumlwiLFxyXG4gICAgICAgICAgICBzdWJtZW51OiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFiZWw6IFwi6IqC54K5XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgYXN5bmMgY2xpY2soKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwcm9wQ29kZSA9IGdldFByb3BDb2RlKFwiTm9kZVwiLCBwcm9wTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0c1N0ciA9IHJlYWRGaWxlU3luYyhzY3JpcHRQYXRoLCBcInV0Zi04XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbWF0Y2hSc3QgPSB0c1N0ci5tYXRjaCgvIGV4dGVuZHMgLio/ey8pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbWF0Y2hSc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVnIG1hdGNoIGZhaWxlZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0c1N0ciA9IHRzU3RyLnJlcGxhY2UobWF0Y2hSc3RbMF0sIG1hdGNoUnN0WzBdICsgJ1xcbicgKyBwcm9wQ29kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlRmlsZVN5bmMoc2NyaXB0UGF0aCwgdHNTdHIsIFwidXRmLThcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBLS1V0aWxzLnJlZnJlc2hSZXNBc3koZGVVdWlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgS0tVdGlscy5zbGVlcEFzeSgwLjUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBLS1V0aWxzLnNldFByb3BlcnR5QXN5KHJvb3ROb2RlVVVpZCwgc2NyaXB0T3JkZXIsIHByb3BOYW1lLCBcImNjLk5vZGVcIiwgaW5mby51dWlkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiBcIue7hOS7tlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1Ym1lbnU6IGNvbXBNZW51c1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfVxyXG4gICAgXTtcclxufSJdfQ==